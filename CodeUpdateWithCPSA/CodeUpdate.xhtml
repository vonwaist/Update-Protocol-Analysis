<?xml version="1.0"?>
<!-- CPSA 2.2.12 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
 <title>Secure Code Update Protocol</title>
 <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
 <style>
  svg.diagram { border-width: 1px; border-style: solid }
 </style>
</head>
<body>

<pre>(herald &quot;Secure Code Update Protocol&quot;)
(comment &quot;CPSA 2.2.12&quot;)
(comment &quot;All input read from CodeUpdate.scm&quot;)</pre>

<p id="top">Trees: <a href="#t0">0</a> <a href="#t2">2</a> <a href="#t4">4</a>.</p>

<p id="t0">Tree <a href="#top">0</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k1&quot;, &quot;_self&quot;)'>1</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k0&quot;, &quot;_self&quot;)'>0</text>
  </svg></div>

<pre>(defprotocol CodeUpdate basic
  (defrole verifier
    (vars (idv idp name) (nv np c1 c2 text) (h1 h2 cupkg result data)
      (k1 k2 skey))
    (trace (send (cat idv c1 c2)) (recv (cat idp np h1 h2))
      (send (cat nv (enc cupkg k1) (enc np idv idp h1 c1 h2 c2 k2)))
      (recv (cat result (enc np nv idv idp h1 c1 h2 c2 result k2)))))
  (defrole prover
    (vars (idv idp name) (nv np c1 c2 text) (h1 h2 cupkg result data)
      (k1 k2 skey))
    (trace (recv (cat idv c1 c2)) (send (cat idp np h1 h2))
      (recv (cat nv (enc cupkg k1) (enc np idv idp h1 c1 h2 c2 k2)))
      (send (cat result (enc np nv idv idp h1 c1 h2 c2 result k2)))))
  (comment &quot;Secure Code Update Protocol Definition&quot;))</pre>

<p id="k0">Item <a href="#t0">0</a>, Child: <a href="#k1">1</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='379.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 379.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(cat result (enc np nv idv idp h1 c1 h2 c2 result k2))</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat nv (enc cupkg k1) (enc np idv idp h1 c1 h2 c2 k2))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(cat idp np h1 h2)</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>(cat idv c1 c2)</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((nv nv) (np np) (c1 c1) (c2 c2) (h1 h1) (h2 h2) (cupkg cupkg) (result result) (idv idv) (idp idp) (k1 k1) (k2 k2))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>verifier</text>
   </g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>CodeUpdate 0</text></svg></div>

<pre>(defskeleton CodeUpdate
  (vars (nv np c1 c2 text) (h1 h2 result cupkg data) (idv idp name)
    (k2 k1 skey))
  (defstrand verifier 4 (nv nv) (np np) (c1 c1) (c2 c2) (h1 h1) (h2 h2)
    (cupkg cupkg) (result result) (idv idv) (idp idp) (k1 k1) (k2 k2))
  (non-orig k2)
  (uniq-orig nv c1 c2)
  (comment &quot;Authentication from the verifier&apos;s perspective&quot;)
  (traces
    ((send (cat idv c1 c2)) (recv (cat idp np h1 h2))
      (send (cat nv (enc cupkg k1) (enc np idv idp h1 c1 h2 c2 k2)))
      (recv (cat result (enc np nv idv idp h1 c1 h2 c2 result k2)))))
  (label 0)
  (unrealized (0 3))
  (origs (nv (0 2)) (c1 (0 0)) (c2 (0 0)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k1">Item <a href="#t0">1</a>, Parent: <a href="#k0">0</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='379.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 379.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat result (enc np nv idv idp h1 c1 h2 c2 result k2))</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat nv (enc cupkg-0 k1-0) (enc np idv idp h1 c1 h2 c2 k2))</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g><title>(cat idp np h1 h2)</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(cat idv c1 c2)</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(cat result (enc np nv idv idp h1 c1 h2 c2 result k2))</title>
   <circle style='fill: blue;' cx='39.960' cy='339.960' r='6.000'/></g>
  <path
   d='M 39.960 264.960 Q 86.940 264.960 133.920 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat nv (enc cupkg k1) (enc np idv idp h1 c1 h2 c2 k2))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(cat idp np h1 h2)</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <path
   d='M 39.960 114.960 Q 86.940 114.960 133.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(cat idv c1 c2)</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((nv nv) (np np) (c1 c1) (c2 c2) (h1 h1) (h2 h2) (cupkg cupkg-0) (result result) (idv idv) (idp idp) (k1 k1-0) (k2 k2))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>prover</text>
   </g>
  <g>
   <title>((nv nv) (np np) (c1 c1) (c2 c2) (h1 h1) (h2 h2) (cupkg cupkg) (result result) (idv idv) (idp idp) (k1 k1) (k2 k2))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>verifier</text>
   </g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>CodeUpdate 1 (realized)</text></svg>
 </div>

<pre>(defskeleton CodeUpdate
  (vars (nv np c1 c2 text) (h1 h2 result cupkg cupkg-0 data)
    (idv idp name) (k2 k1 k1-0 skey))
  (defstrand verifier 4 (nv nv) (np np) (c1 c1) (c2 c2) (h1 h1) (h2 h2)
    (cupkg cupkg) (result result) (idv idv) (idp idp) (k1 k1) (k2 k2))
  (defstrand prover 4 (nv nv) (np np) (c1 c1) (c2 c2) (h1 h1) (h2 h2)
    (cupkg cupkg-0) (result result) (idv idv) (idp idp) (k1 k1-0)
    (k2 k2))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 3) (0 3)))
  (non-orig k2)
  (uniq-orig nv c1 c2)
  (operation encryption-test (added-strand prover 4)
    (enc np nv idv idp h1 c1 h2 c2 result k2) (0 3))
  (traces
    ((send (cat idv c1 c2)) (recv (cat idp np h1 h2))
      (send (cat nv (enc cupkg k1) (enc np idv idp h1 c1 h2 c2 k2)))
      (recv (cat result (enc np nv idv idp h1 c1 h2 c2 result k2))))
    ((recv (cat idv c1 c2)) (send (cat idp np h1 h2))
      (recv (cat nv (enc cupkg-0 k1-0) (enc np idv idp h1 c1 h2 c2 k2)))
      (send (cat result (enc np nv idv idp h1 c1 h2 c2 result k2)))))
  (label 1)
  (parent 0)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((idv idv) (idp idp) (nv nv) (np np) (c1 c1) (c2 c2) (h1 h1)
        (h2 h2) (result result) (k2 k2) (cupkg cupkg) (k1 k1))))
  (origs (nv (0 2)) (c1 (0 0)) (c2 (0 0))))</pre>

<p id="t2">Tree <a href="#top">2</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k3&quot;, &quot;_self&quot;)'>3</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k2&quot;, &quot;_self&quot;)'>2</text>
  </svg></div>

<pre>(defprotocol CodeUpdate basic
  (defrole verifier
    (vars (idv idp name) (nv np c1 c2 text) (h1 h2 cupkg result data)
      (k1 k2 skey))
    (trace (send (cat idv c1 c2)) (recv (cat idp np h1 h2))
      (send (cat nv (enc cupkg k1) (enc np idv idp h1 c1 h2 c2 k2)))
      (recv (cat result (enc np nv idv idp h1 c1 h2 c2 result k2)))))
  (defrole prover
    (vars (idv idp name) (nv np c1 c2 text) (h1 h2 cupkg result data)
      (k1 k2 skey))
    (trace (recv (cat idv c1 c2)) (send (cat idp np h1 h2))
      (recv (cat nv (enc cupkg k1) (enc np idv idp h1 c1 h2 c2 k2)))
      (send (cat result (enc np nv idv idp h1 c1 h2 c2 result k2)))))
  (comment &quot;Secure Code Update Protocol Definition&quot;))</pre>

<p id="k2">Item <a href="#t2">2</a>, Child: <a href="#k3">3</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='304.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 304.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(cat nv (enc cupkg k1) (enc np idv idp h1 c1 h2 c2 k2))</title>
   <circle style='fill: red;' cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(cat idp np h1 h2)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>(cat idv c1 c2)</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((nv nv) (np np) (c1 c1) (c2 c2) (h1 h1) (h2 h2) (cupkg cupkg) (idv idv) (idp idp) (k1 k1) (k2 k2))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>prover</text></g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>CodeUpdate 2</text></svg></div>

<pre>(defskeleton CodeUpdate
  (vars (np c1 c2 nv text) (h1 h2 cupkg data) (idv idp name)
    (k2 k1 skey))
  (defstrand prover 3 (nv nv) (np np) (c1 c1) (c2 c2) (h1 h1) (h2 h2)
    (cupkg cupkg) (idv idv) (idp idp) (k1 k1) (k2 k2))
  (non-orig k2)
  (uniq-orig np)
  (comment &quot;Authentication from the prover&apos;s perspective&quot;)
  (traces
    ((recv (cat idv c1 c2)) (send (cat idp np h1 h2))
      (recv (cat nv (enc cupkg k1) (enc np idv idp h1 c1 h2 c2 k2)))))
  (label 2)
  (unrealized (0 2))
  (origs (np (0 1)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k3">Item <a href="#t2">3</a>, Parent: <a href="#k2">2</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='304.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 304.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 264.960 Q 92.940 264.960 45.960 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat nv-0 (enc cupkg-0 k1-0) (enc np idv idp h1 c1 h2 c2 k2))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g><title>(cat idp np h1 h2)</title>
   <circle style='fill: blue;' cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(cat idv c1 c2)</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(cat nv (enc cupkg k1) (enc np idv idp h1 c1 h2 c2 k2))</title>
   <circle style='fill: blue;' cx='39.960' cy='264.960' r='6.000'/></g>
  <path
   d='M 39.960 189.960 Q 86.940 189.960 133.920 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(cat idp np h1 h2)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>(cat idv c1 c2)</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((nv nv-0) (np np) (c1 c1) (c2 c2) (h1 h1) (h2 h2) (cupkg cupkg-0) (idv idv) (idp idp) (k1 k1-0) (k2 k2))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>verifier</text>
   </g>
  <g>
   <title>((nv nv) (np np) (c1 c1) (c2 c2) (h1 h1) (h2 h2) (cupkg cupkg) (idv idv) (idp idp) (k1 k1) (k2 k2))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>prover</text></g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>CodeUpdate 3 (realized)</text></svg>
 </div>

<pre>(defskeleton CodeUpdate
  (vars (np c1 c2 nv nv-0 text) (h1 h2 cupkg cupkg-0 data)
    (idv idp name) (k2 k1 k1-0 skey))
  (defstrand prover 3 (nv nv) (np np) (c1 c1) (c2 c2) (h1 h1) (h2 h2)
    (cupkg cupkg) (idv idv) (idp idp) (k1 k1) (k2 k2))
  (defstrand verifier 3 (nv nv-0) (np np) (c1 c1) (c2 c2) (h1 h1)
    (h2 h2) (cupkg cupkg-0) (idv idv) (idp idp) (k1 k1-0) (k2 k2))
  (precedes ((0 1) (1 1)) ((1 2) (0 2)))
  (non-orig k2)
  (uniq-orig np)
  (operation encryption-test (added-strand verifier 3)
    (enc np idv idp h1 c1 h2 c2 k2) (0 2))
  (traces
    ((recv (cat idv c1 c2)) (send (cat idp np h1 h2))
      (recv (cat nv (enc cupkg k1) (enc np idv idp h1 c1 h2 c2 k2))))
    ((send (cat idv c1 c2)) (recv (cat idp np h1 h2))
      (send
        (cat nv-0 (enc cupkg-0 k1-0) (enc np idv idp h1 c1 h2 c2 k2)))))
  (label 3)
  (parent 2)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((idv idv) (idp idp) (np np) (c1 c1) (c2 c2) (h1 h1) (h2 h2)
        (k2 k2) (nv nv) (cupkg cupkg) (k1 k1))))
  (origs (np (0 1))))</pre>

<p id="t4">Tree <a href="#top">4</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k5&quot;, &quot;_self&quot;)'>5</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k4&quot;, &quot;_self&quot;)'>4</text>
  </svg></div>

<pre>(defprotocol CodeUpdate basic
  (defrole verifier
    (vars (idv idp name) (nv np c1 c2 text) (h1 h2 cupkg result data)
      (k1 k2 skey))
    (trace (send (cat idv c1 c2)) (recv (cat idp np h1 h2))
      (send (cat nv (enc cupkg k1) (enc np idv idp h1 c1 h2 c2 k2)))
      (recv (cat result (enc np nv idv idp h1 c1 h2 c2 result k2)))))
  (defrole prover
    (vars (idv idp name) (nv np c1 c2 text) (h1 h2 cupkg result data)
      (k1 k2 skey))
    (trace (recv (cat idv c1 c2)) (send (cat idp np h1 h2))
      (recv (cat nv (enc cupkg k1) (enc np idv idp h1 c1 h2 c2 k2)))
      (send (cat result (enc np nv idv idp h1 c1 h2 c2 result k2)))))
  (comment &quot;Secure Code Update Protocol Definition&quot;))</pre>

<p id="k4">Item <a href="#t4">4</a>, Child: <a href="#k5">5</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='379.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 379.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(cat result (enc np nv idv idp h1 c1 h2 c2 result k2))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat nv (enc cupkg k1) (enc np idv idp h1 c1 h2 c2 k2))</title>
   <circle style='fill: red;' cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(cat idp np h1 h2)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>(cat idv c1 c2)</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((nv nv) (np np) (c1 c1) (c2 c2) (h1 h1) (h2 h2) (cupkg cupkg) (result result) (idv idv) (idp idp) (k1 k1) (k2 k2))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>prover</text></g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>CodeUpdate 4</text></svg></div>

<pre>(defskeleton CodeUpdate
  (vars (nv np c1 c2 text) (h1 h2 cupkg result data) (idv idp name)
    (k1 k2 skey))
  (defstrand prover 4 (nv nv) (np np) (c1 c1) (c2 c2) (h1 h1) (h2 h2)
    (cupkg cupkg) (result result) (idv idv) (idp idp) (k1 k1) (k2 k2))
  (non-orig k1)
  (comment &quot;Secrecy from the prover&apos;s perspective&quot;)
  (traces
    ((recv (cat idv c1 c2)) (send (cat idp np h1 h2))
      (recv (cat nv (enc cupkg k1) (enc np idv idp h1 c1 h2 c2 k2)))
      (send (cat result (enc np nv idv idp h1 c1 h2 c2 result k2)))))
  (label 4)
  (unrealized (0 2))
  (origs)
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k5">Item <a href="#t4">5</a>, Parent: <a href="#k4">4</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='379.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 379.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 264.960 Q 92.940 264.960 45.960 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat nv-0 (enc cupkg k1) (enc np-0 idv-0 idp-0 h1-0 c1-0 h2-0 c2-0 k2-0))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g><title>(cat idp-0 np-0 h1-0 h2-0)</title>
   <circle style='fill: blue;' cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(cat idv-0 c1-0 c2-0)</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(cat result (enc np nv idv idp h1 c1 h2 c2 result k2))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat nv (enc cupkg k1) (enc np idv idp h1 c1 h2 c2 k2))</title>
   <circle style='fill: blue;' cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(cat idp np h1 h2)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>(cat idv c1 c2)</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((nv nv-0) (np np-0) (c1 c1-0) (c2 c2-0) (h1 h1-0) (h2 h2-0) (cupkg cupkg) (idv idv-0) (idp idp-0) (k1 k1) (k2 k2-0))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>verifier</text>
   </g>
  <g>
   <title>((nv nv) (np np) (c1 c1) (c2 c2) (h1 h1) (h2 h2) (cupkg cupkg) (result result) (idv idv) (idp idp) (k1 k1) (k2 k2))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>prover</text></g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>CodeUpdate 5 (realized)</text></svg>
 </div>

<pre>(defskeleton CodeUpdate
  (vars (nv np c1 c2 nv-0 np-0 c1-0 c2-0 text)
    (h1 h2 cupkg result h1-0 h2-0 data) (idv idp idv-0 idp-0 name)
    (k1 k2 k2-0 skey))
  (defstrand prover 4 (nv nv) (np np) (c1 c1) (c2 c2) (h1 h1) (h2 h2)
    (cupkg cupkg) (result result) (idv idv) (idp idp) (k1 k1) (k2 k2))
  (defstrand verifier 3 (nv nv-0) (np np-0) (c1 c1-0) (c2 c2-0)
    (h1 h1-0) (h2 h2-0) (cupkg cupkg) (idv idv-0) (idp idp-0) (k1 k1)
    (k2 k2-0))
  (precedes ((1 2) (0 2)))
  (non-orig k1)
  (operation encryption-test (added-strand verifier 3) (enc cupkg k1)
    (0 2))
  (traces
    ((recv (cat idv c1 c2)) (send (cat idp np h1 h2))
      (recv (cat nv (enc cupkg k1) (enc np idv idp h1 c1 h2 c2 k2)))
      (send (cat result (enc np nv idv idp h1 c1 h2 c2 result k2))))
    ((send (cat idv-0 c1-0 c2-0)) (recv (cat idp-0 np-0 h1-0 h2-0))
      (send
        (cat nv-0 (enc cupkg k1)
          (enc np-0 idv-0 idp-0 h1-0 c1-0 h2-0 c2-0 k2-0)))))
  (label 5)
  (parent 4)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((idv idv) (idp idp) (nv nv) (np np) (c1 c1) (c2 c2) (h1 h1)
        (h2 h2) (cupkg cupkg) (k1 k1) (result result) (k2 k2))))
  (origs))</pre>

</body>
</html>
